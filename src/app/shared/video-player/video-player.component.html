<div
  (fullscreenchange)="onFullScreenChange()"
  (mousemove)="onMouseMove()"
  #videoPlayer
  class="video-container"
>
  <video
    (click)="togglePlayPause()"
    (loadeddata)="onVideoSrcChange()"
    (progress)="onBufferProgressUpdate()"
    (durationchange)="onDurationChange()"
    [volume]="volume / maxVolume"
    [muted]="isMute"
    class="video-element"
    src="{{ videos && videos[defaultVideoIndex].src }}"
    (ended)="onVideoEnded()"
  >
    Your browser does not support the video tag.
  </video>

  <div class="controller-wrapper">
    <div class="controller" *ngIf="isControllerVisible">
      <input
        (input)="onProgressBarValueChange($event)"
        [ngStyle]="{
          '--loadWidth': bufferProgress + '%',
          '--currentTime': currentTimeInPercentage + '%'
        }"
        class="progress-bar"
        type="range"
        min="0"
        [max]="duration"
        step="1"
        [value]="currentTime"
      />

      <button class="play-pause-button" (click)="togglePlayPause()">
        <img
          src="assets/images/control-icons/play-solid.svg"
          *ngIf="!isPlaying"
        />
        <img
          src="assets/images/control-icons/pause-solid.svg"
          *ngIf="isPlaying"
        />
      </button>

      <div class="volume-controller">
        <button (click)="toggleMuteUnmute()">
          <img
            *ngIf="!isMute && volume > 50"
            src="assets/images/control-icons/volume-high-solid.svg"
          />
          <img
            *ngIf="!isMute && volume <= 50"
            src="assets/images/control-icons/volume-low-solid.svg"
          />
          <img
            *ngIf="isMute"
            src="assets/images/control-icons/volume-xmark-solid.svg"
          />
        </button>
        <input
          class="volume-slider"
          [ngStyle]="{
          '--volume': volume + '%',
        }"
          type="range"
          min="0"
          max="100"
          step="1"
          value="100"
          (input)="onVolumeChange($event)"
        />
      </div>

      <p class="time-display">{{ timeDisplay }}</p>
      <button (click)="toggleFullScreen()">
        <img src="assets/images/control-icons/expand-solid.svg" />
      </button>

      <button
        [attr.videoQuality]="videos && videos[defaultVideoIndex].quality"
        class="settings-menu-button"
        (click)="openSettingsMenu()"
      >
        <img src="assets/images/control-icons/gear-solid.svg" />
      </button>

      <settings-menu
        (close)="closeSettingsMenu()"
        [isOpen]="isSettingsMenuOpen"
        class="settings-menu main-settings-menu"
      >
        <button (click)="openPlaybackMenu()">
          <span>Playback speed</span>&gt;
        </button>
        <button (click)="openVideoQualityMenu()"><span>Quality</span>&gt;</button>
      </settings-menu>

      <settings-menu
        [showBackButton]="true"
        (goBack)="openSettingsMenu()"
        (close)="closeSettingsMenu()"
        [isOpen]="isPlaybackSpeedMenuOpen"
        class="settings-menu"
      >
        <label
          *ngFor="let rate of playbackRates"
          (click)="setPlaybackRate(rate)"
          ><input
            name="playbackRate"
            type="radio"
            [checked]="rate === currentPlaybackRate"
          />
          {{ rate === 1 ? "Normal" : rate }}
        </label>
      </settings-menu>

      <settings-menu
        [showBackButton]="true"
        (goBack)="openSettingsMenu()"
        (close)="closeSettingsMenu()"
        [isOpen]="isQualityMenuOpen"
        class="settings-menu"
      >
        <label
          *ngFor="let videoSrc of videos; let index = index"
          (click)="onVideoQualityChange(index)"
          ><input
            name="videoQuality"
            type="radio"
            [checked]="videoSrc.quality === currentVideoQuality"
          />
          {{ videoSrc.quality }}
        </label>
      </settings-menu>
    </div>
  </div>
</div>
